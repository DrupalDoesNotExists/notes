# Telegram channel notification
name: Telegram notify

# Run on push
on: [push]
jobs:
  notify:
    name: Notify
    runs-on: ubuntu-latest
    if: "contains(github.event.head_commit.message, 'post:')"
    steps:
      - name: Get post slug
        env:
          COMMIT_NAME: ${{ github.event.head_commit.message }}
        id: post_slug
        run: echo "slug=${COMMIT_NAME##*slug:##\spost:*}" >> $GITHUB_OUTPUT

      - name: Get post title
        env:
          COMMIT_NAME: ${{ github.event.head_commit.message }}
        id: post_title
        run: echo "title=${COMMIT_NAME##*post:}" >> $GITHUB_OUTPUT

      - name: Send telegram message
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHANNEL }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            Новый пост!

            [${{ steps.post_title.outputs.title }}](https://${{ github.repository_owner }}.github.io/${{ github.repository_name }}${{ steps.post_slug.outputs.slug }})
            Автор: **${{ github.event.head_commit.author.name }}**
