# Telegram channel notification
name: Telegram notify

# Run on push
on: [push]
jobs:
  notify:
    name: Notify
    runs-on: ubuntu-latest
    if: "contains(github.event.head_commit.message, 'post:')"
    steps:
      - name: Get post slug
        env:
          COMMIT_NAME: ${{ github.event.head_commit.message }}
        id: post_slug
        run: echo "post_title::${COMMIT_NAME##*slug:\s##post:*}" >> $GITHUB_OUTPUT

      - name: Get post title
        env:
          COMMIT_NAME: ${{ github.event.head_commit.message }}
        id: post_title
        run: echo "post_title::${COMMIT_NAME##*post:\s}" >> $GITHUB_OUTPUT

      - name: Send telegram message
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHANNEL }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            Новый пост!

            [${{ steps.post_title.outputs[0] }}](https://${{ github.repository_owner }}.github.io/${{ github.repository_name }}/posts/${{ steps.post_slug.outputs[0] }})
            Автор: **${{ github.event.head_commit.author.name }}**
